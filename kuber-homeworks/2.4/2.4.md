# Домашнее задание к занятию «Helm»

### Цель задания

В тестовой среде Kubernetes необходимо установить и обновить приложения с помощью Helm.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение, например, MicroK8S.

```
$ microk8s
Available subcommands are:
	add-node
	addons
	config
	ctr
	dashboard-proxy
	dbctl
	disable
	enable
	helm
	helm3
	images
	istioctl
	join
	kubectl
	leave
	linkerd
	refresh-certs
	remove-node
	reset
	start
	status
	stop
	version
	inspect
```

2. Установленный локальный kubectl.

```
$ kubectl 
kubectl controls the Kubernetes cluster manager.

 Find more information at: https://kubernetes.io/docs/reference/kubectl/

Basic Commands (Beginner):
  create          Create a resource from a file or from stdin
  expose          Take a replication controller, service, deployment or pod and expose it as a new Kubernetes service
  run             Run a particular image on the cluster
  set             Set specific features on objects

Basic Commands (Intermediate):
  explain         Get documentation for a resource
  get             Display one or many resources
  edit            Edit a resource on the server
  delete          Delete resources by file names, stdin, resources and names, or by resources and label selector

Deploy Commands:
  rollout         Manage the rollout of a resource
  scale           Set a new size for a deployment, replica set, or replication controller
  autoscale       Auto-scale a deployment, replica set, stateful set, or replication controller

Cluster Management Commands:
  certificate     Modify certificate resources
  cluster-info    Display cluster information
  top             Display resource (CPU/memory) usage
  cordon          Mark node as unschedulable
  uncordon        Mark node as schedulable
  drain           Drain node in preparation for maintenance
  taint           Update the taints on one or more nodes

Troubleshooting and Debugging Commands:
  describe        Show details of a specific resource or group of resources
  logs            Print the logs for a container in a pod
  attach          Attach to a running container
  exec            Execute a command in a container
  port-forward    Forward one or more local ports to a pod
  proxy           Run a proxy to the Kubernetes API server
  cp              Copy files and directories to and from containers
  auth            Inspect authorization
  debug           Create debugging sessions for troubleshooting workloads and nodes
  events          List events

Advanced Commands:
  diff            Diff the live version against a would-be applied version
  apply           Apply a configuration to a resource by file name or stdin
  patch           Update fields of a resource
  replace         Replace a resource by file name or stdin
  wait            Experimental: Wait for a specific condition on one or many resources
  kustomize       Build a kustomization target from a directory or URL

Settings Commands:
  label           Update the labels on a resource
  annotate        Update the annotations on a resource
  completion      Output shell completion code for the specified shell (bash, zsh, fish, or powershell)

Subcommands provided by plugins:

Other Commands:
  api-resources   Print the supported API resources on the server
  api-versions    Print the supported API versions on the server, in the form of "group/version"
  config          Modify kubeconfig files
  plugin          Provides utilities for interacting with plugins
  version         Print the client and server version information

Usage:
  kubectl [flags] [options]

Use "kubectl <command> --help" for more information about a given command.
Use "kubectl options" for a list of global command-line options (applies to all commands).
```

3. Установленный локальный Helm.

```
$ sudo snap install helm --classic
helm 3.17.4 from Snapcrafters✪ installed
$ helm
The Kubernetes package manager

Common actions for Helm:

- helm search:    search for charts
- helm pull:      download a chart to your local directory to view
- helm install:   upload the chart to Kubernetes
- helm list:      list releases of charts

Environment variables:

| Name                               | Description                                                                                                |
|------------------------------------|------------------------------------------------------------------------------------------------------------|
| $HELM_CACHE_HOME                   | set an alternative location for storing cached files.                                                      |
| $HELM_CONFIG_HOME                  | set an alternative location for storing Helm configuration.                                                |
| $HELM_DATA_HOME                    | set an alternative location for storing Helm data.                                                         |
| $HELM_DEBUG                        | indicate whether or not Helm is running in Debug mode                                                      |
| $HELM_DRIVER                       | set the backend storage driver. Values are: configmap, secret, memory, sql.                                |
| $HELM_DRIVER_SQL_CONNECTION_STRING | set the connection string the SQL storage driver should use.                                               |
| $HELM_MAX_HISTORY                  | set the maximum number of helm release history.                                                            |
| $HELM_NAMESPACE                    | set the namespace used for the helm operations.                                                            |
| $HELM_NO_PLUGINS                   | disable plugins. Set HELM_NO_PLUGINS=1 to disable plugins.                                                 |
| $HELM_PLUGINS                      | set the path to the plugins directory                                                                      |
| $HELM_REGISTRY_CONFIG              | set the path to the registry config file.                                                                  |
| $HELM_REPOSITORY_CACHE             | set the path to the repository cache directory                                                             |
| $HELM_REPOSITORY_CONFIG            | set the path to the repositories file.                                                                     |
| $KUBECONFIG                        | set an alternative Kubernetes configuration file (default "~/.kube/config")                                |
| $HELM_KUBEAPISERVER                | set the Kubernetes API Server Endpoint for authentication                                                  |
| $HELM_KUBECAFILE                   | set the Kubernetes certificate authority file.                                                             |
| $HELM_KUBEASGROUPS                 | set the Groups to use for impersonation using a comma-separated list.                                      |
| $HELM_KUBEASUSER                   | set the Username to impersonate for the operation.                                                         |
| $HELM_KUBECONTEXT                  | set the name of the kubeconfig context.                                                                    |
| $HELM_KUBETOKEN                    | set the Bearer KubeToken used for authentication.                                                          |
| $HELM_KUBEINSECURE_SKIP_TLS_VERIFY | indicate if the Kubernetes API server's certificate validation should be skipped (insecure)                |
| $HELM_KUBETLS_SERVER_NAME          | set the server name used to validate the Kubernetes API server certificate                                 |
| $HELM_BURST_LIMIT                  | set the default burst limit in the case the server contains many CRDs (default 100, -1 to disable)         |
| $HELM_QPS                          | set the Queries Per Second in cases where a high number of calls exceed the option for higher burst values |

Helm stores cache, configuration, and data based on the following configuration order:

- If a HELM_*_HOME environment variable is set, it will be used
- Otherwise, on systems supporting the XDG base directory specification, the XDG variables will be used
- When no other location is set a default location will be used based on the operating system

By default, the default directories depend on the Operating System. The defaults are listed below:

| Operating System | Cache Path                | Configuration Path             | Data Path               |
|------------------|---------------------------|--------------------------------|-------------------------|
| Linux            | $HOME/.cache/helm         | $HOME/.config/helm             | $HOME/.local/share/helm |
| macOS            | $HOME/Library/Caches/helm | $HOME/Library/Preferences/helm | $HOME/Library/helm      |
| Windows          | %TEMP%\helm               | %APPDATA%\helm                 | %APPDATA%\helm          |

Usage:
  helm [command]

Available Commands:
  completion  generate autocompletion scripts for the specified shell
  create      create a new chart with the given name
  dependency  manage a chart's dependencies
  env         helm client environment information
  get         download extended information of a named release
  help        Help about any command
  history     fetch release history
  install     install a chart
  lint        examine a chart for possible issues
  list        list releases
  package     package a chart directory into a chart archive
  plugin      install, list, or uninstall Helm plugins
  pull        download a chart from a repository and (optionally) unpack it in local directory
  push        push a chart to remote
  registry    login to or logout from a registry
  repo        add, list, remove, update, and index chart repositories
  rollback    roll back a release to a previous revision
  search      search for a keyword in charts
  show        show information of a chart
  status      display the status of the named release
  template    locally render templates
  test        run tests for a release
  uninstall   uninstall a release
  upgrade     upgrade a release
  verify      verify that a chart at the given path has been signed and is valid
  version     print the client version information

Flags:
      --burst-limit int                 client-side default throttling limit (default 100)
      --debug                           enable verbose output
  -h, --help                            help for helm
      --kube-apiserver string           the address and the port for the Kubernetes API server
      --kube-as-group stringArray       group to impersonate for the operation, this flag can be repeated to specify multiple groups.
      --kube-as-user string             username to impersonate for the operation
      --kube-ca-file string             the certificate authority file for the Kubernetes API server connection
      --kube-context string             name of the kubeconfig context to use
      --kube-insecure-skip-tls-verify   if true, the Kubernetes API server's certificate will not be checked for validity. This will make your HTTPS connections insecure
      --kube-tls-server-name string     server name to use for Kubernetes API server certificate validation. If it is not provided, the hostname used to contact the server is used
      --kube-token string               bearer token used for authentication
      --kubeconfig string               path to the kubeconfig file
  -n, --namespace string                namespace scope for this request
      --qps float32                     queries per second used when communicating with the Kubernetes API, not including bursting
      --registry-config string          path to the registry config file (default "/home/alyona/.config/helm/registry/config.json")
      --repository-cache string         path to the directory containing cached repository indexes (default "/home/alyona/.cache/helm/repository")
      --repository-config string        path to the file containing repository names and URLs (default "/home/alyona/.config/helm/repositories.yaml")

Use "helm [command] --help" for more information about a command.

```

4. Редактор YAML-файлов с подключенным репозиторием GitHub.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция](https://helm.sh/docs/intro/install/) по установке Helm. [Helm completion](https://helm.sh/docs/helm/helm_completion/).

------

### Задание 1. Подготовить Helm-чарт для приложения

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. Каждый компонент приложения деплоится отдельным deployment’ом или statefulset’ом.
3. В переменных чарта измените образ приложения для изменения версии.

### Решение

```
$ tree
.
├── 2.4.md
├── grafana
│   ├── Chart.yaml
│   ├── templates
│   │   ├── deployment.yaml
│   │   ├── _helpers.tpl
│   │   ├── hpa.yaml
│   │   ├── ingress.yaml
│   │   ├── NOTES.txt
│   │   ├── pvc.yaml
│   │   ├── serviceaccount.yaml
│   │   ├── service.yaml
│   │   └── tests
│   │       └── test-connection.yaml
│   └── values.yaml
├── grafana1-values.yaml
├── grafana2-values.yaml
└── grafana3-values.yaml

4 directories, 15 files
```

Готовый values.yaml:

```
# Default values for grafana.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: grafana/grafana
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: "10.4.2"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 472
  supplementalGroups:
    - 0

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 3000

ingress:
  enabled: true
  className: ""
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: microk8s.nedorezov.ru
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

livenessProbe:
  failureThreshold: 3
  initialDelaySeconds: 30
  periodSeconds: 10
  successThreshold: 1
  tcpSocket:
    port: 3000
  timeoutSeconds: 1

readinessProbe:
  failureThreshold: 3
  httpGet:
    path: /robots.txt
    port: 3000
    scheme: HTTP
  initialDelaySeconds: 10
  periodSeconds: 30
  successThreshold: 1
  timeoutSeconds: 2

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

persistence:
  enabled: true
  storageClassName: nfs
  storage: 2Gi
  accessModes:
    - ReadWriteOnce

# Additional volumes on the output Deployment definition.
volumes: []

# Additional volumeMounts on the output Deployment definition.
volumeMounts: []

nodeSelector: {}

tolerations: []

affinity: {}

# extraEnvs: {}
```

Запаковка .tgz

```
$ helm package grafana
Successfully packaged chart and saved it to: /home/alyona/repo/NETOLOGY-SHVIRTD-17/kuber-homeworks/2.4/grafana-0.1.3.tgz
```

Проверка созданного архива grafana-0.1.3.tgz

```
$ ls -l
total 40
-rw-rw-r-- 1 alyona alyona 14550 авг  8 15:22 2.4.md
drwxrwxr-x 3 alyona alyona  4096 авг  8 15:23 grafana
-rw-rw-r-- 1 alyona alyona  4456 авг  8 15:25 grafana-0.1.3.tgz
-rw-rw-r-- 1 alyona alyona    22 авг  8 15:17 grafana1-values.yaml
-rw-rw-r-- 1 alyona alyona    57 авг  8 15:17 grafana2-values.yaml
-rw-rw-r-- 1 alyona alyona    49 авг  8 15:17 grafana3-values.yaml
```

По умолчанию версия 10.4.2, но можно переопределить через values

```
apiVersion: v2
name: grafana
description: A Helm chart for installing Grafana in Kubernetes

# A chart can be either an 'application' or a 'library' chart.
#
# Application charts are a collection of templates that can be packaged into versioned archives
# to be deployed.
#
# Library charts provide useful utilities or functions for the chart developer. They're included as
# a dependency of application charts to inject those utilities and functions into the rendering
# pipeline. Library charts do not define any templates and therefore cannot be deployed.
type: application

# This is the chart version. This version number should be incremented each time you make changes
# to the chart and its templates, including the app version.
# Versions are expected to follow Semantic Versioning (https://semver.org/)
version: 0.1.3

# This is the version number of the application being deployed. This version number should be
# incremented each time you make changes to the application. Versions are not expected to
# follow Semantic Versioning. They should reflect the version the application is using.
# It is recommended to use it with quotes.
appVersion: "10.4.2"
```

------
### Задание 2. Запустить две версии в разных неймспейсах

1. Подготовив чарт, необходимо его проверить. Запуститe несколько копий приложения.
2. Одну версию в namespace=app1, вторую версию в том же неймспейсе, третью версию в namespace=app2.
3. Продемонстрируйте результат.

### Решение

созданы следующие .yaml (фрагмент команды ls -l) для разных версий

```
-rw-rw-r-- 1 alyona alyona    22 авг  8 15:17 grafana1-values.yaml
-rw-rw-r-- 1 alyona alyona    57 авг  8 15:17 grafana2-values.yaml
-rw-rw-r-- 1 alyona alyona    49 авг  8 15:17 grafana3-values.yaml
```

- версия grafana1-values.yaml: "10.4.2", имя: grafana-latest
- версия grafana2-values.yaml: "11.0.0-preview", имя: grafana-prewiew
- версия grafana3-values.yaml: "9.5.18", имя: grafana-oldstable

Установка grafana1-values.yaml (namespace=app1) через команду "$ microk8s helm upgrade --install grafana-latest ./grafana -n app1 --create-namespace -f grafana1-values.yaml --timeout 600s --debug"

```
$ microk8s helm upgrade --install grafana-latest ./grafana -n app1 --create-namespace -f grafana1-values.yaml --timeout 600s --debug
history.go:56: 2025-08-08 16:09:28.304918362 +0300 MSK m=+0.119549774 [debug] getting history for release grafana-latest
Release "grafana-latest" does not exist. Installing it now.
install.go:224: 2025-08-08 16:09:28.307962354 +0300 MSK m=+0.122593773 [debug] Original chart version: ""
install.go:241: 2025-08-08 16:09:28.308000025 +0300 MSK m=+0.122631432 [debug] CHART PATH: /home/alyona/repo/NETOLOGY-SHVIRTD-17/kuber-homeworks/2.4/grafana

client.go:142: 2025-08-08 16:09:28.766743121 +0300 MSK m=+0.581374540 [debug] creating 1 resource(s)
client.go:142: 2025-08-08 16:09:28.77901073 +0300 MSK m=+0.593642146 [debug] creating 5 resource(s)
NAME: grafana-latest
LAST DEPLOYED: Fri Aug  8 16:09:28 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
USER-SUPPLIED VALUES:
image:
  tag: 10.4.2

COMPUTED VALUES:
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: IfNotPresent
  repository: grafana/grafana
  tag: 10.4.2
imagePullSecrets: []
ingress:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
  className: ""
  enabled: true
  hosts:
  - host: microk8s.nedorezov.ru
    paths:
    - path: /
      pathType: Prefix
  tls: []
livenessProbe:
  failureThreshold: 3
  initialDelaySeconds: 30
  periodSeconds: 10
  successThreshold: 1
  tcpSocket:
    port: 3000
  timeoutSeconds: 1
nameOverride: ""
nodeSelector: {}
persistence:
  accessModes:
  - ReadWriteOnce
  enabled: true
  storage: 2Gi
  storageClassName: nfs
podAnnotations: {}
podLabels: {}
podSecurityContext:
  fsGroup: 472
  supplementalGroups:
  - 0
readinessProbe:
  failureThreshold: 3
  httpGet:
    path: /robots.txt
    port: 3000
    scheme: HTTP
  initialDelaySeconds: 10
  periodSeconds: 30
  successThreshold: 1
  timeoutSeconds: 2
replicaCount: 1
resources: {}
securityContext: {}
service:
  port: 3000
  type: ClusterIP
serviceAccount:
  annotations: {}
  automount: true
  create: true
  name: ""
tolerations: []
volumeMounts: []
volumes: []

HOOKS:
---
# Source: grafana/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "grafana-latest-test-connection"
  labels:
    helm.sh/chart: grafana-0.1.3
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
    app.kubernetes.io/version: "10.4.2"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['grafana-latest:3000']
  restartPolicy: Never
MANIFEST:
---
# Source: grafana/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: grafana-latest
  labels:
    helm.sh/chart: grafana-0.1.3
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
    app.kubernetes.io/version: "10.4.2"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: true
---
# Source: grafana/templates/pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: grafana-latest
spec:
  storageClassName: nfs
  accessModes:
    - "ReadWriteOnce"
  resources:
    requests:
      storage: 2Gi
---
# Source: grafana/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: grafana-latest
  labels:
    helm.sh/chart: grafana-0.1.3
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
    app.kubernetes.io/version: "10.4.2"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 3000
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
---
# Source: grafana/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana-latest
  labels:
    helm.sh/chart: grafana-0.1.3
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
    app.kubernetes.io/version: "10.4.2"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: grafana
      app.kubernetes.io/instance: grafana-latest
  template:
    metadata:
      labels:
        helm.sh/chart: grafana-0.1.3
        app.kubernetes.io/name: grafana
        app.kubernetes.io/instance: grafana-latest
        app.kubernetes.io/version: "10.4.2"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: grafana-latest
      securityContext:
        fsGroup: 472
        supplementalGroups:
        - 0
      containers:
        - name: grafana
          securityContext:
            {}
          image: "grafana/grafana:10.4.2"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 3000
              protocol: TCP
          livenessProbe:
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 10
            successThreshold: 1
            tcpSocket:
              port: 3000
            timeoutSeconds: 1
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /robots.txt
              port: 3000
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 2
          resources:
            {}
          volumeMounts:
            - mountPath: /var/lib/grafana
              name: grafana-latest
          
#           env:
#             - name: GF_SERVER_SERVE_FROM_SUB_PATH
#               valueFrom:
#                 configMapKeyRef:
#                   name: grafana-latest-config
#                   key: GF_SERVER_SERVE_FROM_SUB_PATH
#             - name: GF_SERVER_ROOT_URL
#               valueFrom:
#                 configMapKeyRef:
#                   name: grafana-latest-config
#                   key: GF_SERVER_ROOT_URL
      volumes:
        - name: grafana-latest
          persistentVolumeClaim:
            claimName: grafana-latest
---
# Source: grafana/templates/ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: grafana-latest
  labels:
    helm.sh/chart: grafana-0.1.3
    app.kubernetes.io/name: grafana
    app.kubernetes.io/instance: grafana-latest
    app.kubernetes.io/version: "10.4.2"
    app.kubernetes.io/managed-by: Helm
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
    - host: "microk8s.nedorezov.ru"
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: grafana-latest
                port:
                  number: 3000

NOTES:
1. Get the application URL by running these commands:
  http://microk8s.nedorezov.ru/

```

Как можно заменить, все хорошо и все выполнилось. Далее без --debug

Установка grafana1-values.yaml (namespace=app1) через команду "$ microk8s helm upgrade --install grafana-prewiew ./grafana -n app1 --create-namespace -f grafana2-values.yaml --timeout 600s"

```
$ microk8s helm upgrade --install grafana-prewiew ./grafana -n app1 --create-namespace -f grafana2-values.yaml --timeout 600s
Release "grafana-prewiew" does not exist. Installing it now.
NAME: grafana-prewiew
LAST DEPLOYED: Fri Aug  8 16:10:18 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace app1 -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance=grafana-prewiew" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace app1 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace app1 port-forward $POD_NAME 8080:$CONTAINER_PORT
```

Установка grafana1-values.yaml (namespace=app2)  через команду "$ microk8s helm upgrade --install grafana-oldstable ./grafana -n app2 --create-namespace -f grafana3-values.yaml --timeout 600s"

```
$ microk8s helm upgrade --install grafana-oldstable ./grafana -n app2 --create-namespace -f grafana3-values.yaml --timeout 600s
Release "grafana-oldstable" does not exist. Installing it now.
NAME: grafana-oldstable
LAST DEPLOYED: Fri Aug  8 16:10:46 2025
NAMESPACE: app2
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace app2 -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance=grafana-oldstable" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace app2 $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace app2 port-forward $POD_NAME 8080:$CONTAINER_PORT
```

Итог:

```
$ microk8s helm list -A
NAME             	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART        	APP VERSION
grafana-latest   	app1     	1       	2025-08-08 16:09:28.323169992 +0300 MSK	deployed	grafana-0.1.3	10.4.2     
grafana-oldstable	app2     	1       	2025-08-08 16:10:46.295928315 +0300 MSK	deployed	grafana-0.1.3	10.4.2     
grafana-prewiew  	app1     	1       	2025-08-08 16:10:18.778585064 +0300 MSK	deployed	grafana-0.1.3	10.4.2   
```

```
$ microk8s kubectl get po -n app1
NAME                               READY   STATUS    RESTARTS   AGE
grafana-latest-59bd7f7db5-xxts8    0/1     ContainerCreating   0          10m
grafana-prewiew-7c65cf4859-zp2zf   0/1     ContainerCreating   0          9m24s
$ microk8s kubectl get po -n app2
NAME                                 READY   STATUS    RESTARTS   AGE
grafana-oldstable-75d74958bf-jtqwg   0/1     ContainerCreating   0          9m1s
```

